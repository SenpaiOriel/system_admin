  <script src="https://cdn.jsdelivr.net/npm/qrcode@1/build/qrcode.min.js"></script>

  <script src="frontend/js/system-setup-auth.js"></script>
  <div id="app" class="setup-wrap" :class="[isDark ? 'theme-dark' : 'theme-light', showAdmin ? 'admin-wrap' : '']">
    <!-- Circuit background -->
    <div class="circuit-bg" aria-hidden="true">
      <svg class="circuit-svg" viewBox="0 0 1200 900" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="200" cy="120" r="5" class="node"/>
        <circle cx="1000" cy="100" r="5" class="node"/>
        <circle cx="1050" cy="280" r="5" class="node"/>
        <circle cx="150" cy="380" r="5" class="node"/>
        <circle cx="1100" cy="450" r="5" class="node"/>
        <circle cx="80" cy="600" r="5" class="node"/>
        <circle cx="1050" cy="720" r="5" class="node"/>
        <circle cx="220" cy="800" r="5" class="node"/>
        <circle cx="600" cy="80" r="5" class="node"/>
        <circle cx="580" cy="820" r="5" class="node"/>
        <path d="M 380 200 L 200 200 L 200 120" class="line"/>
        <path d="M 820 200 L 1000 200 L 1000 100" class="line"/>
        <path d="M 820 350 L 1000 350 L 1050 280" class="line"/>
        <path d="M 380 450 L 200 450 L 150 380" class="line"/>
        <path d="M 820 500 L 1050 500 L 1100 450" class="line"/>
        <path d="M 400 650 L 150 650 L 80 600" class="line"/>
        <path d="M 800 700 L 1000 700 L 1050 720" class="line"/>
        <path d="M 400 750 L 280 750 L 220 800" class="line"/>
        <path d="M 600 250 L 600 80" class="line"/>
        <path d="M 600 650 L 600 820" class="line"/>
        <path d="M 380 320 L 280 320 L 280 380" class="line"/>
        <path d="M 820 320 L 920 320 L 920 400" class="line"/>
      </svg>
    </div>

    <main v-if="!showAdmin" class="setup-card">
      <template v-if="!setupComplete">
        <registration-form />
      </template>
      <div v-else class="setup-complete">
        <p class="setup-complete-title">{{ t.setupCompleteTitle }}</p>
        <p class="setup-complete-msg">{{ t.setupCompleteMsg }}</p>
        <button type="button" class="btn btn-next" style="margin-top:1rem;" @click="goToAdmin">{{ t.openSystemAdmin }}</button>
      </div>
    </main>

    <template v-if="showAdmin">
      <div class="theme-toggle-wrap" role="switch" :aria-checked="isDark" aria-label="Light or dark mode">
        <button type="button" class="theme-toggle" @click="isDark = !isDark" :class="{ dark: isDark, light: !isDark }">
          <span class="toggle-track"><span class="toggle-pill"></span></span>
        </button>
      </div>
      <aside class="admin-sidebar">
        <div class="admin-user-block">
          <div class="admin-avatar" aria-hidden="true">
            <img v-if="owner.profileDataUrl" :src="owner.profileDataUrl" alt="" class="admin-avatar-img">
            <svg v-else viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/></svg>
          </div>
          <div class="admin-user-info">
            <p class="admin-user-name">{{ owner.firstName || "User's Name" }} {{ owner.lastName }}</p>
            <p class="admin-user-role">System Administrator</p>
          </div>
        </div>
        <nav class="admin-nav">
          <button type="button" class="admin-nav-item" :class="{ active: currentSection === 'services' }" @click="currentSection = 'services'">Services</button>
          <button type="button" class="admin-nav-item" :class="{ active: currentSection === 'plugins' }" @click="currentSection = 'plugins'">Plugins</button>
          <button type="button" class="admin-nav-item" :class="{ active: currentSection === 'users' }" @click="currentSection = 'users'">Users</button>
          <button type="button" class="admin-nav-item" :class="{ active: currentSection === 'auth-keys' }" @click="currentSection = 'auth-keys'">Auth Keys</button>
          <button type="button" class="admin-nav-item" :class="{ active: currentSection === 'monitoring' }" @click="currentSection = 'monitoring'">Monitoring</button>
        </nav>
      </aside>
      <main class="admin-main">
        <p class="admin-breadcrumb">System Admin &gt; <span>{{ sectionTitle }}</span></p>
        <div class="admin-content-card">
          <h2 class="admin-page-header"><span class="admin-page-title">{{ sectionTitle }}</span></h2>
          <template v-if="currentSection === 'plugins'">
            <div class="admin-toolbar">
              <div class="admin-summary-card">
                <div class="admin-summary-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                </div>
                <div>
                  <p class="admin-summary-label">Total Plugins</p>
                  <p class="admin-summary-value">{{ filteredPlugins.length }}</p>
                </div>
              </div>
              <div class="admin-search-wrap">
                <span class="admin-search-icon" aria-hidden="true">üîç</span>
                <input type="search" class="admin-search" placeholder="Search" v-model="pluginSearch" aria-label="Search plugins">
              </div>
            </div>
            <div class="admin-table-wrap">
              <table class="admin-table">
                <thead>
                  <tr><th>Name</th><th>Version</th><th>Action</th></tr>
                </thead>
                <tbody>
                  <tr v-for="plugin in filteredPlugins" :key="plugin.id">
                    <td>{{ plugin.name }}</td>
                    <td>{{ plugin.version }}</td>
                    <td>
                      <button type="button" class="admin-toggle" :class="{ on: plugin.enabled }" @click="plugin.enabled = !plugin.enabled" :aria-label="plugin.enabled ? 'Disable' : 'Enable'">
                        <span class="admin-toggle-pill"></span>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </template>
          <template v-else>
            <p class="section-label" style="margin-top:0;">Select a section from the sidebar. This view shows <strong>{{ sectionTitle }}</strong> when implemented.</p>
          </template>
        </div>
      </main>
    </template>
  </div>
